<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
    <head>
        <title>Replay From Source</title>
        <script src="data.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css" />
        <link rel="stylesheet" href="../shared/common.css" />
    </head>
    <body>
        <div id="root">
            <div class="ui centered grid">
                <div class="sixteen wide column topBar">
                    <div class="ui centered grid dat-page-header">
                        <div class="item">
                            <img id="concordLogo" alt="logo" src="../shared/logo.png" class="ui small image"/>
                        </div>
                    </div>
                </div>
            </div>
            <form id="replaySource" class="ui form">
                <div class="ui two column stackable grid">
                    <div class="three column row">
                        <div class="column">
                            <label><b>Organization</b></label>
                            <div id="onlyOrganization" name="onlyOrganization" class="ui segment">

                            </div>
                        </div>
                        <div class="column">
                            <label><b>Concord Process Identifier</b></label>
                            <div id="onlyProcessId" name="onlyProcessId" class="ui segment">

                            </div>
                        </div>
                        <div class="column">
                            <label><b>User</b></label>
                            <div id="onlyTriggeredBy" name="onlyTriggeredBy" class="ui segment">

                            </div>
                        </div>
                    </div>

                </div>
                <br>
                <div class="sixteen wide mobile thirteen wide tablet thirteen wide computer right floated column" id="content">
                    <div class="ui padded grid">
                        <div class="row">
                            <h1 class="ui huge dividing header">Replay Message Request</h1>
                        </div>
                        <div class="row">
                            <table class="ui very basic table">
                                <tbody>
                                    <tr>
                                        <td>
                                            <label><b>Source</b></label>
                                        </td>
                                        <td>
                                            <div class="ui input focus">
                                                <input id="sourceUrl" name="sourceUrl" type="text" placeholder="Source Url">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label><b>Sink</b></label>
                                        </td>
                                        <td>
                                            <div class="ui input focus">
                                                <input id="sinkUrl" name="sinkUrl" type="text" placeholder="Sink Url">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label><b>Message Id(s)</b></label>
                                        </td>
                                        <td>
                                            <div class="ui input focus">
                                                <input id="messageIds" name="messageIds" type="text" placeholder="Message Id(s)">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <div class="two column row">
                                            <div class="column">
                                                <label>Enable Ordering</label>
                                                <div id="enforceOrdering" name="enforceOrdering" class="ui fluid selection search dropbox">
                                                    <input name="enforceOrdering" type="hidden">
                                                    <i class="dropdown icon"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="sixteen wide mobile thirteen wide tablet thirteen wide computer right floated column" id="buttons">
                    <div class="row">
                        <h1 class="ui huge dividing header"></h1>
                    </div>
                </div>
                <br>
                <button id="customFormSubmitButton" class="ui primary button" type="submit">Submit</button>
                <button class="ui button" type="button" onclick="redirectToProcessPage()">Back to Process Page</button>
            </form>

            <script type="text/javascript">

                function redirectToProcessPage() {
                    window.location.replace("http://localhost:8001/#/process/" + data.values.processId + "/status");
                }

                $(document).ready(function() {
                    initializeFormElements();
                });

                function initializeFormElements() {
                    document.getElementById("onlyTriggeredBy").innerHTML=`${data.values.executedBy}`;
                    document.getElementById("onlyOrganization").innerHTML=`${data.values.organization}`;
                    document.getElementById("onlyProcessId").innerHTML=`${data.values.processId}`;

                    $(.ui.dropdown.enforceOrdering).dropdown();
                    let orderingOptions = []
                    let noOption = {
                        "name" : "No",
                        "value" : "No",
                        "text" : "No"
                    }
                    let yesOption = {
                        "name" : "Yes",
                        "value" : "Yes",
                        "text" : "Yes"
                    }
                    orderingOptions.push(noOption);
                    orderingOptions.push(yesOption);
                    $(.ui.dropdown.enforceOrdering).dropdown({values: orderingOptions});

                    $(.ui.dropdown.environments).dropdown();
                    let environmentOptions = []
                    let devOption = {
                        "name" : "Development",
                        "value" : "Dev",
                        "text" : "Development"
                    }
                    let qaOption = {
                        "name" : "Quality Assurance",
                        "value" : "QA",
                        "text" : "Quality Assurance"
                    }
                    let stageOption = {
                        "name" : "Stage",
                        "value" : "Stage",
                        "text" : "Stage"
                    }
                    let prodOption = {
                        "name" : "Production",
                        "value" : "Prod",
                        "text" : "Production"
                    }
                    environmentOptions.push(devOption);
                    environmentOptions.push(qaOption);
                    environmentOptions.push(stageOption);
                    environmentOptions.push(prodOption);
                    $(.ui.dropdown.environments).dropdown({values: environmentOptions});
                }

                $("#replaySource").submit(function(e) {
                    e.preventDefault();
                    var button = document.getElementById("customFormSubmitButton");
                    button.classList.add("loading");

                    $.ajax({
                        type: "POST",
                        url: data.submitUrl,
                        data: $(this).serialize(),
                        success: function(data) {
                            button.classList.remove("loading");
                            redirectToProcessPage();
                        },
                        error: function(data) {
                            alert("Error in post - check browser console for details!");
                            console.log("ERROR: ");
                            console.log(data);
                            button.classList.remove("loading");
                        }
                    });
                });
            </script>
        </div>
    </body>
</html>